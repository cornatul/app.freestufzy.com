{"version":3,"sources":["./src/app/post/post.page.html","./src/app/post/post.page.ts","./src/app/post/post.page.scss","./src/app/post/post.module.ts","./src/app/post/post.resolver.ts"],"names":[],"mappings":"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","file":"post-post-module-es2015.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar color=\\\"secondary\\\">\\n    <ion-title [innerHTML]=\\\"post.title.rendered\\\">Free Item</ion-title>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button defaultHref=\\\"posts\\\"></ion-back-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content class=\\\"page-content\\\">\\n    <img [src]=\\\"post.image\\\" style=\\\"width: 100vw\\\" />\\n\\n    <h1 [innerHTML]=\\\"post.title.rendered\\\"></h1>\\n    <p class=\\\"post-body\\\" [innerHTML]=\\\"post.content.rendered\\\"></p>\\n\\n    <p>\\n        Item added on <span *ngIf=\\\"!post.modified\\\">{{post.date | date}}</span><span *ngIf=\\\"post.modified\\\">{{post.modified | date}}</span>\\n    </p>\\n\\n    <ion-badge class=\\\"post-category\\\" color=\\\"danger\\\" *ngFor=\\\"let category of categories\\\"\\n      [routerLink]=\\\"['/posts']\\\" [queryParams]=\\\"{ categoryId: category.id,  title: category.name}\\\">\\n      {{category.name}}\\n    </ion-badge>\\n\\n    <ion-list class=\\\"post-comments\\\">\\n      <ion-item *ngFor=\\\"let comment of comments\\\">\\n        <ion-avatar slot=\\\"start\\\">\\n          <img src=\\\"{{comment.author_avatar_urls[24]}}\\\">\\n        </ion-avatar>\\n        <ion-label>\\n          <h2>{{comment.author_name}}</h2>\\n          <p [innerHTML]=\\\"comment.content.rendered\\\"></p>\\n        </ion-label>\\n      </ion-item>\\n    </ion-list>\\n\\n    <ion-infinite-scroll (ionInfinite)=\\\"loadMoreComments($event)\\\">\\n      <ion-infinite-scroll-content\\n      loadingSpinner=\\\"bubbles\\\"\\n      loadingText=\\\"Loading more messages...\\\">\\n      </ion-infinite-scroll-content>\\n    </ion-infinite-scroll>\\n</ion-content>\\n\\n<ion-footer>\\n <ion-toolbar>\\n  <ion-button color=\\\"danger\\\" expand=\\\"block\\\" (click)=\\\"createComment()\\\">Contact User</ion-button>\\n </ion-toolbar>\\n</ion-footer>\\n\";","import { Component, OnInit } from '@angular/core';\nimport { LoadingController, AlertController } from '@ionic/angular';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { WordpressService } from '../services/wordpress.service';\nimport { AuthenticationService } from '../services/authentication.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { of } from 'rxjs';\n\n@Component({\n  selector: 'app-post',\n  templateUrl: './post.page.html',\n  styleUrls: ['./post.page.scss'],\n})\nexport class PostPage implements OnInit {\n\n  post: any;\n  author: string;\n  comments = [];\n  categories = [];\n\n  constructor(\n    public loadingController: LoadingController,\n    public alertController: AlertController,\n    private router: Router,\n    private route: ActivatedRoute,\n    public wordpressService: WordpressService,\n    public authenticationService: AuthenticationService\n  ) {}\n\n  async ngOnInit() {\n    this.route.data.subscribe(routeData => {\n      const data = routeData['data'];\n      this.post = data.post;\n      this.author = data.author.name;\n      this.categories = data.categories;\n      this.comments = data.comments;\n    });\n  }\n\n  getComments(){\n    return this.wordpressService.getComments(this.post.id);\n  }\n\n  loadMoreComments(event) {\n    const page = (this.comments.length / 10) + 1;\n\n    this.wordpressService.getComments(this.post.id, page)\n    .subscribe((comments: []) => {\n      this.comments.push(...comments);\n      event.target.complete();\n    }, err => {\n      // there are no more comments available\n      event.target.disabled = true;\n    });\n  }\n\n  async createComment() {\n    const loggedUser = await this.authenticationService.getUser();\n\n    if (loggedUser) {\n      const user = JSON.parse(loggedUser);\n\n      // check if token is valid\n      this.authenticationService.validateAuthToken(user.token)\n      .pipe(\n        catchError(error => of(error)),\n        map(result => {\n          if (result.error) {\n            // token is expired\n            this.openLogInAlert();\n          }\n          else {\n            // user is logged in and token is valid\n            this.openEnterCommentAlert(user);\n          }\n        })\n      ).subscribe();\n    } else {\n      await this.openLogInAlert();\n    }\n  }\n\n  async openLogInAlert() {\n    const alert = await this.alertController.create({\n      header: 'Please login',\n      message: 'You need to login in order to contact the user',\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel'\n        },\n        {\n          text: 'Login',\n          handler: () => {\n            this.router.navigate(['/login']);\n          }\n        }\n      ]\n    });\n    await alert.present();\n  }\n\n  async openEnterCommentAlert(user: any) {\n    const alert = await this.alertController.create({\n      header: 'Send a message',\n      inputs: [\n        {\n          name: 'comment',\n          type: 'text',\n          placeholder: 'Message'\n        }\n      ],\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel'\n        },\n        {\n          text: 'Accept',\n          handler: async data => {\n            const loading = await this.loadingController.create();\n            await loading.present();\n\n            this.wordpressService.createComment(this.post.id, user, data.comment)\n            .subscribe(\n              async (data) => {\n                this.getComments().subscribe( async comments => {\n                  this.comments = Object.keys(comments).map(i => comments[i]);\n                  await loading.dismiss();\n                });\n              },\n              async (err) => {\n                await loading.dismiss();\n              }\n            );\n          }\n        }\n      ]\n    });\n    await alert.present();\n  }\n}\n","export default \".page-content {\\n  --padding-top: 20px;\\n  --padding-start: 20px;\\n  --padding-end: 20px;\\n}\\n.page-content .post-body {\\n  font-size: 16px;\\n  color: var(--ion-color-primary-tint);\\n  line-height: 1.5;\\n}\\n.page-content .post-category {\\n  -webkit-margin-end: 6px;\\n          margin-inline-end: 6px;\\n}\\n.page-content .post-comments {\\n  margin-top: 16px;\\n}\\n::ng-deep .post-body img {\\n  height: 100%;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Bvc3QucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsbUJBQUE7RUFDQSxxQkFBQTtFQUNBLG1CQUFBO0FBQ0Y7QUFDRTtFQUNFLGVBQUE7RUFDQSxvQ0FBQTtFQUNBLGdCQUFBO0FBQ0o7QUFFRTtFQUNFLHVCQUFBO1VBQUEsc0JBQUE7QUFBSjtBQUdFO0VBQ0UsZ0JBQUE7QUFESjtBQU9JO0VBQ0UsWUFBQTtBQUpOIiwiZmlsZSI6InBvc3QucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLnBhZ2UtY29udGVudCB7XG4gIC0tcGFkZGluZy10b3A6IDIwcHg7XG4gIC0tcGFkZGluZy1zdGFydDogMjBweDtcbiAgLS1wYWRkaW5nLWVuZDogMjBweDtcblxuICAucG9zdC1ib2R5IHtcbiAgICBmb250LXNpemU6IDE2cHg7XG4gICAgY29sb3I6IHZhcigtLWlvbi1jb2xvci1wcmltYXJ5LXRpbnQpO1xuICAgIGxpbmUtaGVpZ2h0OiAxLjU7XG4gIH1cblxuICAucG9zdC1jYXRlZ29yeSB7XG4gICAgbWFyZ2luLWlubGluZS1lbmQ6IDZweDtcbiAgfVxuXG4gIC5wb3N0LWNvbW1lbnRzIHtcbiAgICBtYXJnaW4tdG9wOiAxNnB4O1xuICB9XG59XG5cbjo6bmctZGVlcCB7XG4gIC5wb3N0LWJvZHkge1xuICAgIGltZyB7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgfVxuICB9XG59XG4iXX0= */\";","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { PostPage } from './post.page';\nimport { PostResolver } from './post.resolver';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PostPage,\n    resolve: {\n      data: PostResolver\n    }\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [PostPage],\n  providers: [PostResolver]\n})\nexport class PostPageModule {}\n","import { Injectable } from '@angular/core';\nimport { Resolve, ActivatedRouteSnapshot } from '@angular/router';\nimport { WordpressService } from '../services/wordpress.service';\nimport { Observable, forkJoin } from 'rxjs';\nimport { map, concatMap } from 'rxjs/operators';\n\n@Injectable()\nexport class PostResolver implements Resolve<any> {\n\n  constructor(private wordpressService: WordpressService) { }\n\n  resolve(route: ActivatedRouteSnapshot): Observable<any> {\n    const id = route.paramMap.get('id');\n\n    return this.wordpressService.getPost(id)\n    .pipe(\n      concatMap((post: any) => {\n        const author = this.wordpressService.getAuthor(post.author);\n        const categories = this.wordpressService.getPostCategories(post);\n        const comments = this.wordpressService.getComments(post.id);\n\n        return forkJoin({ author, categories, comments })\n        .pipe(\n          map(postData => {\n            return {...postData, post};\n          })\n        )\n      })\n    );\n  }\n}\n"],"sourceRoot":"webpack:///"}