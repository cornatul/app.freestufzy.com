{"version":3,"sources":["./src/app/login/login.page.ts","./src/app/login/login.guard.ts","./src/app/login/login.page.html","./src/app/login/login.module.ts","./src/app/login/login.page.scss"],"names":[],"mappings":"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","file":"login-login-module-es2015.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Validators, FormBuilder, FormGroup, FormControl } from '@angular/forms';\nimport { LoadingController } from '@ionic/angular';\nimport { AuthenticationService } from '../services/authentication.service';\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.page.html',\n  styleUrls: ['./login.page.scss'],\n})\nexport class LoginPage implements OnInit {\n\n  loginForm: FormGroup;\n  errorMessage: string;\n\n  constructor(\n    private router: Router,\n    public loadingController: LoadingController,\n    public formBuilder: FormBuilder,\n    public authenticationService: AuthenticationService\n  ) {}\n\n  ngOnInit() {\n    this.loginForm = this.formBuilder.group({\n      username: new FormControl('', Validators.required),\n      password: new FormControl('', Validators.required)\n    });\n  }\n\n  async doLogin() {\n    const loading = await this.loadingController.create({\n      message: 'Please wait...'\n    });\n    await loading.present();\n\n    this.authenticationService.doLogin(this.loginForm.value.username, this.loginForm.value.password)\n    .subscribe(res => {\n      this.authenticationService.setUser({\n        token: res['token'],\n        username: this.loginForm.value.username,\n        displayname: res['user_display_name'],\n        email: res['user_email']\n      });\n\n      loading.dismiss();\n      this.router.navigate(['/posts']);\n    },\n    err => {\n      loading.dismiss();\n      this.errorMessage = \"Invalid credentials\";\n    })\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate, Router } from '@angular/router';\nimport { AuthenticationService } from '../services/authentication.service';\nimport { catchError, concatMap, map } from 'rxjs/operators';\nimport { of, from } from 'rxjs';\n\n@Injectable()\nexport class LoginGuard implements CanActivate {\n\n  constructor(\n    private authenticationService: AuthenticationService,\n    public router: Router\n  ) {}\n\n  canActivate() {\n    return from(this.authenticationService.getUser())\n    .pipe(\n      concatMap(user => {\n        if (user) { // user is the value returned from the local storage\n          return this.authenticationService.validateAuthToken(JSON.parse(user).token)\n            .pipe(\n              catchError(error => of(error)),\n              map(result => {\n                if (result.error) {\n                  // token is expired\n                  return true;\n                }\n                else {\n                  // user is logged in and token is valid\n                  return this.router.parseUrl('/posts');\n                }\n              })\n            );\n        } else {\n          // there is no logged user\n          return of(true);\n        }\n      })\n    );\n  }\n}\n","export default \"<ion-content class=\\\"page-content\\\">\\n\\n  <ion-grid>\\n    <ion-row>\\n      <ion-col size=\\\"12\\\">\\n        <div style=\\\"align-items: center\\\">\\n         <center>\\n           <img src=\\\"assets/images/logo-512.png\\\"  alt=\\\"logo\\\"/>\\n         </center>\\n        </div>\\n      </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n\\n\\n  <form class=\\\"login-form\\\" [formGroup]=\\\"loginForm\\\" (submit)=\\\"doLogin()\\\">\\n    <ion-item class=\\\"input-item\\\">\\n      <ion-label color=\\\"secondary\\\" position=\\\"stacked\\\">Username</ion-label>\\n      <ion-input type=\\\"text\\\" formControlName=\\\"username\\\" clearInput=\\\"true\\\"></ion-input>\\n    </ion-item>\\n\\n    <ion-item class=\\\"input-item\\\">\\n      <ion-label color=\\\"secondary\\\" position=\\\"stacked\\\">Password</ion-label>\\n      <ion-input type=\\\"password\\\" formControlName=\\\"password\\\" clearInput=\\\"true\\\"></ion-input>\\n    </ion-item>\\n\\n    <p class=\\\"error-message\\\" *ngIf=\\\"errorMessage\\\">{{errorMessage}}</p>\\n\\n    <p class=\\\"sign-up\\\">\\n      <a [routerLink]=\\\"['/register']\\\">Don't have an account?</a>\\n    </p>\\n\\n    <p class=\\\"skip-login\\\">\\n      <ion-button color=\\\"warning\\\" [routerLink]=\\\"['/posts']\\\">Skip log in</ion-button>\\n    </p>\\n    <ion-button class=\\\"submit-btn\\\" color=\\\"danger\\\" expand=\\\"block\\\" [disabled]=\\\"!loginForm.valid\\\" type=\\\"submit\\\" strong=\\\"true\\\">Log In</ion-button>\\n  </form>\\n</ion-content>\\n\";","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { LoginPage } from './login.page';\nimport { LoginGuard } from './login.guard';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: LoginPage,\n    canActivate: [LoginGuard]\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [LoginPage],\n  providers: [LoginGuard]\n})\nexport class LoginPageModule {}\n","export default \".page-content {\\n  --padding-top: 20px;\\n  --padding-start: 20px;\\n  --padding-end: 20px;\\n  --background: var(--ion-color-light);\\n}\\n\\n.input-item {\\n  --padding-start: 0px;\\n  --background: var(--ion-color-light);\\n}\\n\\n.skip-login {\\n  text-align: right;\\n  color: white;\\n}\\n\\n.skip-login a {\\n  text-decoration: none;\\n  color: white;\\n}\\n\\n.skip-login ion-button {\\n  color: white;\\n}\\n\\n.skip-login .ion-color-warning {\\n  color: white;\\n}\\n\\n.sign-up {\\n  text-align: right;\\n  margin-top: 40px;\\n}\\n\\n.sign-up a {\\n  text-decoration: none;\\n}\\n\\n.login-form {\\n  margin-top: 50px;\\n}\\n\\n.login-button {\\n  margin-top: 30px;\\n}\\n\\n.error-message {\\n  color: var(--ion-color-danger);\\n}\\n\\n.submit-btn {\\n  margin-top: 60px;\\n}\\n\\nimg {\\n  flex-direction: column;\\n  align-items: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xvZ2luLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUVFLG1CQUFBO0VBQ0EscUJBQUE7RUFDQSxtQkFBQTtFQUNBLG9DQUFBO0FBQUY7O0FBR0E7RUFDRSxvQkFBQTtFQUNBLG9DQUFBO0FBQUY7O0FBR0E7RUFDRSxpQkFBQTtFQUNBLFlBQUE7QUFBRjs7QUFDRTtFQUNFLHFCQUFBO0VBQ0EsWUFBQTtBQUNKOztBQUNFO0VBQ0UsWUFBQTtBQUNKOztBQUNFO0VBQ0UsWUFBQTtBQUNKOztBQUdBO0VBQ0UsaUJBQUE7RUFDQSxnQkFBQTtBQUFGOztBQUVFO0VBQ0UscUJBQUE7QUFBSjs7QUFJQTtFQUNFLGdCQUFBO0FBREY7O0FBSUE7RUFDRSxnQkFBQTtBQURGOztBQUlBO0VBQ0UsOEJBQUE7QUFERjs7QUFJQTtFQUNFLGdCQUFBO0FBREY7O0FBSUE7RUFDRSxzQkFBQTtFQUNBLG1CQUFBO0FBREYiLCJmaWxlIjoibG9naW4ucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLnBhZ2UtY29udGVudCB7XG5cbiAgLS1wYWRkaW5nLXRvcDogMjBweDtcbiAgLS1wYWRkaW5nLXN0YXJ0OiAyMHB4O1xuICAtLXBhZGRpbmctZW5kOiAyMHB4O1xuICAtLWJhY2tncm91bmQ6IHZhcigtLWlvbi1jb2xvci1saWdodCk7XG59XG5cbi5pbnB1dC1pdGVtIHtcbiAgLS1wYWRkaW5nLXN0YXJ0OiAwcHg7XG4gIC0tYmFja2dyb3VuZDogdmFyKC0taW9uLWNvbG9yLWxpZ2h0KTtcbn1cblxuLnNraXAtbG9naW4ge1xuICB0ZXh0LWFsaWduOiByaWdodDtcbiAgY29sb3I6IHdoaXRlO1xuICBhIHtcbiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgY29sb3I6d2hpdGU7XG4gIH1cbiAgaW9uLWJ1dHRvbntcbiAgICBjb2xvcjogd2hpdGU7XG4gIH1cbiAgLmlvbi1jb2xvci13YXJuaW5ne1xuICAgIGNvbG9yOiB3aGl0ZTtcbiAgfVxufVxuXG4uc2lnbi11cCB7XG4gIHRleHQtYWxpZ246IHJpZ2h0O1xuICBtYXJnaW4tdG9wOiA0MHB4O1xuXG4gIGEge1xuICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgfVxufVxuXG4ubG9naW4tZm9ybSB7XG4gIG1hcmdpbi10b3A6IDUwcHhcbn1cblxuLmxvZ2luLWJ1dHRvbiB7XG4gIG1hcmdpbi10b3A6IDMwcHg7XG59XG5cbi5lcnJvci1tZXNzYWdlIHtcbiAgY29sb3I6IHZhcigtLWlvbi1jb2xvci1kYW5nZXIpO1xufVxuXG4uc3VibWl0LWJ0biB7XG4gIG1hcmdpbi10b3A6IDYwcHg7XG59XG5cbmltZ3tcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbn1cbiJdfQ== */\";"],"sourceRoot":"webpack:///"}